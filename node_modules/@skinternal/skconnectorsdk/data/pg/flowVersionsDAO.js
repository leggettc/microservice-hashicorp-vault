/**
 * Created by hiteshkalra on 7/12/19.
 */

const constants = require('../../config/constants');

const collectionName = constants.flowVersionsTable;

exports.getFlowVersion = async (flowId,companyId,versionId) =>{

  const queryParams = [`${flowId}`,`${companyId}`,`${versionId}`]
  const query = `
    SELECT * FROM ${collectionName} 
    WHERE flowId = $1 AND companyId = $2 AND versionId = $3
    ;
    `;
  try {
    const response = await global.pg.query(query,queryParams);
    if (!(response && response.rows && Array.isArray(response.rows) &&  response.rows.length >0)){
      return
    }
    const finalResponse = {_id: {flowId:response.rows[0].flowid,companyId: response.rows[0].companyid,versionId: response.rows[0].versionid}, ...response.rows[0].data}
    return finalResponse
  } catch (err) {
    throw err
  }

}
