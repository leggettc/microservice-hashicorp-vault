/**
 * Created by hiteshkalra on 6/16/19.
 */

constants = require('../../config/constants');

const collectionName = constants.connectorsTable;


const getConnector = async (connectorId) => {

  const queryParams = [`${connectorId}`]
  const query = `
    SELECT * FROM ${collectionName} 
    WHERE _id = $1
    ;
    `;
  try {
    const response = await global.pg.query(query,queryParams);
    if (!(response && response.rows && Array.isArray(response.rows) &&  response.rows.length >0)){
      return
    }
    const finalResponse = {_id:response.rows[0]._id,...response.rows[0].data}
    return finalResponse
  } catch (err) {
    throw err
  }

};
const getConnectorList = async (connectorList) => {
  if(!(connectorList && connectorList.length > 0)) {
    return []
  }

  const response = await Promise.all(connectorList.map(async(k) => {
    return getConnector(k);
  }))
  return response.filter(k=>k!= null);
}


module.exports = {
  getConnector,
  getConnectorList,
}