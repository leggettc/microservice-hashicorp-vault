/**
 * Created by hiteshkalra on 4/23/20.
 */
const flowsDAO = require('../data/flowsDAO');
const nodeCache = require('node-cache');
const flowsCache = new nodeCache()

exports.getFlow = async (companyId,flowId) => {
  try {
    const flowFromCache = await flowsCache.get(`${companyId}_${flowId}`)
    if (flowFromCache) {
//      console.log("getFlow: Cache Hit")
      return flowFromCache
    }
    console.log("getFlow: Cache Miss")
    return flowsDAO.getFlow(companyId, flowId).then(k => {
      k.companyId = k._id.companyId
      k.flowId = k._id.flowId
      delete k._id
      flowsCache.set(`${companyId}_${flowId}`, k)
      return k
    });

  } catch (err) {
    throw err
  }
}

exports.invalidateFlowFromCache = (companyId,flowId) =>{
  flowsCache.del(`${companyId}_${flowId}`)
}