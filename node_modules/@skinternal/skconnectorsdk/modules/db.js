const mongoClient = require('./mongoClient')
const pgClient = require('./pgClient')
const {logger} = require('@skinternal/sk-logger');

const initialize = () => {
    let dbToUse = 'mongo'
    if (global.secrets && global.secrets.db && global.secrets.db.dbToUse && global.secrets.db.dbToUse ==='pg') {
        dbToUse = 'pg'
    }
    global.dbToUse = dbToUse
    if(dbToUse === 'mongo'){
        logger.info('Initializing MongoDB')
        return mongoClient.initialize()
    }else if (dbToUse === 'pg'){
        logger.info('Initializing Postgres DB')
        return pgClient.initialize()
    }else {
        logger.error('Could not initialize DB')
        throw new Error('Could not initialize DB')
    }
};

module.exports = {
    initialize,
};
