/**
 * Created by hiteshkalra on 2/16/19.
 */

const AWS = require('aws-sdk')
const {logger} = require('@skinternal/sk-logger');

const configParams = {};
configParams.region = process.env['SK_AWS_REGION'] ? process.env['SK_AWS_REGION'] : 'us-west-2'
if(process.env['SK_AWS_ACCESS_KEY_ID']) configParams.accessKeyId = process.env['SK_AWS_ACCESS_KEY_ID'];
if(process.env['SK_AWS_ACCESS_KEY_SECRET']) configParams.secretAccessKey = process.env['SK_AWS_ACCESS_KEY_SECRET'];
AWS.config.update(configParams);

const kms = new AWS.KMS();

exports.decrypt = async (keyId,cipherText) => {
    const params = {
        KeyId: keyId,
        CiphertextBlob: cipherText
    };

    try {
        const response = await kms.decrypt(params).promise()
        return response
    } catch (err) {
        console.log('decrypt',err)
        throw err
    }
}
