/**
 * Created by hiteshkalra on 1/11/20.
 */

const HashRing = require('hashring');
let allRings = {}

let microservices = {
  oe:['0']  //Default 1 instance
}

//Create Defaults
Object.keys(microservices).forEach(k=>{
  allRings[k] = new HashRing(microservices[k])
})

exports.initialize = (msInstances) => {
  console.log('hashRing initializing')
  if(msInstances){
    Object.keys(msInstances).forEach(k=>{
      exports.updateHashRingForMS(k,msInstances[k])
    })
  }
  console.log('hashRing initialization complete')
}

exports.updateHashRingForMS = (identity,instances) =>{
    console.log(`updating hashRing for ${identity} from ${microservices[identity]} to ${instances}`)
    microservices[identity] = instances
    allRings[identity] = new HashRing(instances)
}

exports.getInstanceByCH = (identity,interactionId) =>{
  return `${identity}_${allRings[identity].get(interactionId)}`
}

