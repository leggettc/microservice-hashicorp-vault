const {logger} = require('@skinternal/sk-logger');
const mongojs = require('mongojs');
const _ = require('lodash')
let uri = '';
global.mongo = '';

const initialize = () =>{

  let {username,password,uri,usePath} = global.secrets.db || {}
  if(usePath && global.partnerSecrets){
    logger.info('db usePath')
    username = _.get(global.partnerSecrets,username,'')
    password = _.get(global.partnerSecrets,password,'')
    uri = _.get(global.partnerSecrets,uri,'')
  }
  logger.info('db info to Use',{username,uri,usePath})

  if(username === '') {
    uri = `mongodb://${uri}`;
  } else {
    uri = `mongodb://${username}:${password}@${uri}`;
  }
  global.mongo = mongojs(uri);
  logger.info('Configured Mongo DB')
};

module.exports = {
  initialize,
};
